<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PanelHub - Online Panel Discussion</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #4361ee;
      --primary-dark: #3a56d4;
      --bg-dark: #121318;
      --bg-light: #1e1f26;
      --text-light: #e2e8f0;
      --border: #2d3748;
      --sidebar-width: 340px;
      --control-height: 70px;
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; background:var(--bg-dark); color:var(--text-light); height:100vh; overflow:hidden; display:flex; }

    /* ---------- Sidebar ---------- */
    #sidebar { width:var(--sidebar-width); background:var(--bg-light); border-right:1px solid var(--border); display:flex; flex-direction:column; position:relative; transition:width .3s; }
    .sidebar-header { padding:16px; font-weight:600; font-size:1.1rem; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
    .tab-buttons { display:flex; background:var(--bg-dark); border-bottom:1px solid var(--border); }
    .tab-btn { flex:1; padding:12px; background:none; border:none; color:#94a3b8; font-size:.9rem; cursor:pointer; transition:.2s; }
    .tab-btn.active { color:white; background:var(--primary); }
    .tab-btn:hover:not(.active){ background:rgba(255,255,255,.05); }
    .tab-content { flex:1; overflow-y:auto; padding:16px; display:none; }
    .tab-content.active { display:block; }

    /* Chat */
    #chat-messages { height:calc(100% - 60px); overflow-y:auto; margin-bottom:10px; }
    .message { margin:8px 0; padding:8px 12px; background:var(--bg-dark); border-radius:12px; max-width:85%; word-wrap:break-word; font-size:.9rem; }
    .message.self { background:var(--primary); margin-left:auto; border-bottom-right-radius:4px; }
    .message.other { border-bottom-left-radius:4px; }
    #chat-input-container { display:flex; gap:8px; }
    #chat-input { flex:1; padding:10px 14px; background:var(--bg-dark); border:1px solid var(--border); border-radius:20px; color:white; font-size:.9rem; }
    #chat-input:focus { outline:none; border-color:var(--primary); }

    /* Files */
    .file-item { display:flex; justify-content:space-between; align-items:center; padding:10px; background:var(--bg-dark); border-radius:8px; margin:8px 0; font-size:.9rem; }
    .file-item button { background:var(--primary); border:none; color:white; padding:4px 10px; border-radius:4px; font-size:.8rem; cursor:pointer; }

    /* Participants */
    .participant { display:flex; align-items:center; padding:10px; background:var(--bg-dark); border-radius:8px; margin:8px 0; font-size:.9rem; }
    .participant-avatar { width:32px; height:32px; background:var(--primary); border-radius:50%; display:flex; align-items:center; justify-content:center; margin-right:10px; font-weight:bold; font-size:.8rem; }

    /* Resizer */
    .resizer { width:5px; background:var(--border); cursor:col-resize; position:absolute; right:0; top:0; bottom:0; z-index:10; }

    /* ---------- Main ---------- */
    #main-content { flex:1; display:flex; flex-direction:column; position:relative; }
    #video-grid { flex:1; padding:16px; display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:16px; overflow-y:auto; background:#0f0f12; }
    .video-container { position:relative; background:#000; border-radius:12px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,.3); }
    .video-container video { width:100%; height:100%; object-fit:cover; }
    .video-label { position:absolute; bottom:8px; left:8px; background:rgba(0,0,0,.7); color:white; padding:4px 10px; border-radius:20px; font-size:.8rem; font-weight:500; }
    .video-container.local .video-label { background:var(--primary); }
    .video-container.screenshare { grid-column:1/-1; }

    #shared-content { height:250px; background:var(--bg-light); border-top:1px solid var(--border); padding:16px; overflow:hidden; position:relative; }
    #shared-content iframe,#shared-content video,#shared-content img { width:100%; height:100%; border-radius:8px; object-fit:contain; background:#000; }

    /* ---------- Controls ---------- */
    #controls { position:absolute; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(18,19,24,.9); backdrop-filter:blur(12px); padding:10px 16px; border-radius:50px; display:flex; gap:12px; box-shadow:0 8px 24px rgba(0,0,0,.4); z-index:100; }
    .control-btn { width:48px; height:48px; border-radius:50%; background:#2d3748; border:none; color:white; font-size:1.1rem; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:.2s; }
    .control-btn:hover { background:#4a5568; }
    .control-btn.active { background:var(--primary); }
    .control-btn.danger { background:#e53e3e; }
    .control-btn.danger:hover { background:#c53030; }

    /* Recording indicator */
    .record-indicator { position:relative; }
    .record-dot { position:absolute; top:4px; right:4px; width:10px; height:10px; background:#ff3b30; border-radius:50%; animation:pulse 1.5s infinite; }
    @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:.4;} }

    /* Upload */
    #upload-area { margin:16px 0; padding:16px; background:var(--bg-dark); border:2px dashed var(--border); border-radius:12px; text-align:center; cursor:pointer; transition:.2s; }
    #upload-area:hover { border-color:var(--primary); background:rgba(67,97,238,.1); }
    #upload-area input { display:none; }

    /* Modal */
    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.9); z-index:1000; justify-content:center; align-items:center; padding:20px; }
    .modal.active { display:flex; }
    .modal-content { max-width:95%; max-height:95%; border-radius:12px; overflow:hidden; }
    .close-modal { position:absolute; top:20px; right:30px; font-size:2rem; color:white; cursor:pointer; z-index:1001; }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div id="sidebar">
    <div class="resizer" id="resizer"></div>
    <div class="sidebar-header">PanelHub <span id="room-id">Room #1234</span></div>

    <div class="tab-buttons">
      <button class="tab-btn active" data-tab="chat">Chat</button>
      <button class="tab-btn" data-tab="files">Files</button>
      <button class="tab-btn" data-tab="participants">People</button>
    </div>

    <!-- Chat -->
    <div id="chat" class="tab-content active">
      <div id="chat-messages"></div>
      <div id="chat-input-container">
        <input type="text" id="chat-input" placeholder="Type a message..." />
        <button onclick="sendMessage()" class="control-btn"><i class="fas fa-paper-plane"></i></button>
      </div>
    </div>

    <!-- Files -->
    <div id="files" class="tab-content">
      <div id="upload-area">
        <input type="file" id="file-upload" multiple accept="video/*,.pdf,.ppt,.pptx,.txt,image/*" />
        <i class="fas fa-cloud-upload-alt fa-2x"></i>
        <p>Drop files here or click to upload</p>
      </div>
      <div id="uploaded-files-list"></div>
    </div>

    <!-- Participants -->
    <div id="participants" class="tab-content">
      <div id="participants-list">
        <div class="participant"><div class="participant-avatar">Y</div> You (Host)</div>
      </div>
    </div>
  </div>

  <!-- Main -->
  <div id="main-content">
    <div id="video-grid"></div>

    <div id="shared-content">
      <p style="text-align:center; color:#94a3b8; margin-top:80px;">
        <i class="fas fa-share-alt fa-3x"></i><br>Shared content will appear here
      </p>
    </div>

    <!-- Floating Controls (RECORD BUTTON ADDED) -->
    <div id="controls">
      <button class="control-btn" id="mic-btn" onclick="toggleMic()"><i class="fas fa-microphone"></i></button>
      <button class="control-btn" id="cam-btn" onclick="toggleCam()"><i class="fas fa-video"></i></button>

      <!-- RECORD BUTTON -->
      <div class="record-indicator">
        <button class="control-btn" id="record-btn" onclick="toggleRecording()">
          <i class="fas fa-circle"></i>
        </button>
        <div id="record-dot" class="record-dot" style="display:none;"></div>
      </div>

      <button class="control-btn" onclick="shareScreen()"><i class="fas fa-desktop"></i></button>
      <button class="control-btn" onclick="openUpload()"><i class="fas fa-upload"></i></button>
      <button class="control-btn danger" onclick="endCall()"><i class="fas fa-phone-slash"></i></button>
    </div>
  </div>

  <!-- Fullscreen Modal -->
  <div id="modal" class="modal">
    <span class="close-modal" onclick="closeModal()">&times;</span>
    <div class="modal-content" id="modal-content"></div>
  </div>

  <script>
    // ================== STATE ==================
    let localStream = null, screenStream = null;
    let isMicOn = true, isCamOn = true;
    let recorder = null, recordedChunks = [];
    let recordingStartTime = 0;
    let recordTimer = null;

    // ================== DOM ==================
    const videoGrid = document.getElementById('video-grid');
    const sharedContent = document.getElementById('shared-content');
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const fileUpload = document.getElementById('file-upload');
    const uploadArea = document.getElementById('upload-area');
    const uploadedFilesList = document.getElementById('uploaded-files-list');
    const participantsList = document.getElementById('participants-list');
    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('modal-content');
    const recordBtn = document.getElementById('record-btn');
    const recordDot = document.getElementById('record-dot');

    // ================== TABS ==================
    document.querySelectorAll('.tab-btn').forEach(b=>b.addEventListener('click',()=>{
      document.querySelectorAll('.tab-btn,.tab-content').forEach(el=>el.classList.remove('active'));
      b.classList.add('active');
      document.getElementById(b.dataset.tab).classList.add('active');
    }));

    // ================== RESIZER ==================
    const resizer = document.getElementById('resizer');
    let resizing = false;
    resizer.addEventListener('mousedown',e=>{ resizing=true; });
    document.addEventListener('mousemove',e=>{ if(resizing){ const w=e.clientX; if(w>250&&w<500) document.documentElement.style.setProperty('--sidebar-width',w+'px'); }});
    document.addEventListener('mouseup',()=>{ resizing=false; });

    // ================== VIDEO / AUDIO ==================
    async function startCamera(){
      try{ localStream = await navigator.mediaDevices.getUserMedia({video:true,audio:true}); addVideoStream(localStream,'You',true); }
      catch(err){ console.error('Camera denied',err); }
    }
    function addVideoStream(stream,name,isLocal=false){
      const cont = document.createElement('div'); cont.className=`video-container ${isLocal?'local':''}`;
      const vid = document.createElement('video'); vid.srcObject=stream; vid.autoplay=true; vid.playsinline=true; vid.muted=isLocal;
      const lbl = document.createElement('div'); lbl.className='video-label'; lbl.textContent=name;
      cont.append(vid,lbl); videoGrid.appendChild(cont);
    }

    function toggleMic(){
      if(!localStream) return;
      isMicOn=!isMicOn; localStream.getAudioTracks()[0].enabled=isMicOn;
      document.getElementById('mic-btn').innerHTML = isMicOn ? '<i class="fas fa-microphone"></i>' : '<i class="fas fa-microphone-slash"></i>';
    }
    function toggleCam(){
      if(!localStream) return;
      isCamOn=!isCamOn; localStream.getVideoTracks()[0].enabled=isCamOn;
      document.getElementById('cam-btn').innerHTML = isCamOn ? '<i class="fas fa-video"></i>' : '<i class="fas fa-video-slash"></i>';
    }

    // ================== SCREEN SHARE ==================
    async function shareScreen(){
      try{
        screenStream = await navigator.mediaDevices.getDisplayMedia({video:true});
        const cont = document.createElement('div'); cont.className='video-container screenshare';
        const vid = document.createElement('video'); vid.srcObject=screenStream; vid.autoplay=true;
        const lbl = document.createElement('div'); lbl.className='video-label'; lbl.textContent='Screen Share';
        cont.append(vid,lbl); videoGrid.prepend(cont);
        screenStream.getTracks()[0].addEventListener('ended',()=>cont.remove());
      }catch(err){ console.error('Screen share failed',err); }
    }

    // ================== RECORDING ==================
    async function toggleRecording(){
      if(recorder && recorder.state==='recording'){
        // STOP
        recorder.stop();
        recordBtn.innerHTML = '<i class="fas fa-circle"></i>';
        recordDot.style.display='none';
        clearInterval(recordTimer);
      }else{
        // START â€“ combine webcam + screen (if sharing) or just webcam
        const streams = [];
        if(localStream) streams.push(localStream);
        if(screenStream) streams.push(screenStream);

        if(streams.length===0){ alert('No media to record'); return; }

        const mixed = new MediaStream();
        streams.forEach(s=>{ s.getTracks().forEach(t=>mixed.addTrack(t)); });

        recorder = new MediaRecorder(mixed,{mimeType:'video/webm;codecs=vp9'});
        recordedChunks = [];

        recorder.ondataavailable = e=>{ if(e.data.size>0) recordedChunks.push(e.data); };
        recorder.onstop = ()=>{ saveRecording(); };
        recorder.start();

        recordBtn.innerHTML = '<i class="fas fa-stop"></i>';
        recordDot.style.display='block';
        recordingStartTime = Date.now();
        recordTimer = setInterval(updateTimer,500);
      }
    }

    function updateTimer(){
      const elapsed = Math.floor((Date.now()-recordingStartTime)/1000);
      const min = String(Math.floor(elapsed/60)).padStart(2,'0');
      const sec = String(elapsed%60).padStart(2,'0');
      recordBtn.title = `Recording ${min}:${sec}`;
    }

    function saveRecording(){
      const blob = new Blob(recordedChunks,{type:'video/webm'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.style.display='none';
      a.href=url;
      a.download=`PanelHub_Recording_${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.webm`;
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{ document.body.removeChild(a); URL.revokeObjectURL(url); },100);
    }

    // ================== CHAT ==================
    function sendMessage(){
      const txt = chatInput.value.trim(); if(!txt) return;
      const div = document.createElement('div'); div.className='message self'; div.textContent=txt;
      chatMessages.appendChild(div); chatMessages.scrollTop=chatMessages.scrollHeight;
      chatInput.value='';
      setTimeout(()=>{ const r=document.createElement('div'); r.className='message other'; r.textContent='Thanks!'; chatMessages.appendChild(r); chatMessages.scrollTop=chatMessages.scrollHeight; },1000);
    }
    chatInput.addEventListener('keypress',e=>{ if(e.key==='Enter') sendMessage(); });

    // ================== FILE UPLOAD ==================
    uploadArea.addEventListener('click',()=>fileUpload.click());
    ['dragover','dragleave','drop'].forEach(ev=>uploadArea.addEventListener(ev,e=>{ e.preventDefault(); uploadArea.style.borderColor = (ev==='dragover'?'var(--primary)':'var(--border)'); }));
    uploadArea.addEventListener('drop',e=>{ e.preventDefault(); handleFiles(e.dataTransfer.files); });
    fileUpload.addEventListener('change',()=>handleFiles(fileUpload.files));

    let uploadedFiles=[];
    function handleFiles(files){
      for(let f of files){ uploadedFiles.push(f); addFileToList(f); }
      fileUpload.value='';
    }
    function addFileToList(file){
      const div=document.createElement('div'); div.className='file-item';
      div.innerHTML=`<span><i class="fas fa-file"></i> ${file.name}</span><button onclick="displayFile('${file.name}')">Show</button>`;
      uploadedFilesList.appendChild(div);
    }
    window.displayFile = name=>{
      const file = uploadedFiles.find(f=>f.name===name); if(!file) return;
      sharedContent.innerHTML=''; let el;
      if(file.type.startsWith('image/')){ el=document.createElement('img'); el.src=URL.createObjectURL(file); }
      else if(file.type.startsWith('video/')){ el=document.createElement('video'); el.src=URL.createObjectURL(file); el.controls=true; }
      else if(file.type.includes('pdf')||file.type.includes('presentation')){ el=document.createElement('iframe'); el.src=URL.createObjectURL(file); }
      else{ alert('Preview not supported'); return; }
      el.style.height='100%'; sharedContent.appendChild(el);
      const btn=document.createElement('button'); btn.textContent='Full Screen'; btn.style.position='absolute'; btn.style.top='10px'; btn.style.right='10px'; btn.style.zIndex='10';
      btn.onclick=()=>{ openModal(el.cloneNode(true)); }; sharedContent.appendChild(btn);
    };
    function openUpload(){ document.querySelector('[data-tab="files"]').click(); }

    // ================== MODAL ==================
    function openModal(content){ modalContent.innerHTML=''; modalContent.appendChild(content); modal.classList.add('active'); }
    function closeModal(){ modal.classList.remove('active'); }

    // ================== END CALL ==================
    function endCall(){
      [localStream,screenStream].forEach(s=>{ if(s) s.getTracks().forEach(t=>t.stop()); });
      if(recorder && recorder.state==='recording') recorder.stop();
      videoGrid.innerHTML=''; alert('Call ended');
    }

    // ================== DUMMY PARTICIPANTS ==================
    function addDummyParticipants(){
      const names=['Dr. Smith','Prof. Lee','Alex Chen'];
      names.forEach(name=>{
        const p=document.createElement('div'); p.className='participant';
        p.innerHTML=`<div class="participant-avatar">${name[0]}</div> ${name}`; participantsList.appendChild(p);

        const vid=document.createElement('video');
        vid.src='https://www.w3schools.com/html/mov_bbb.mp4'; vid.loop=vid.muted=vid.autoplay=true;
        const cont=document.createElement('div'); cont.className='video-container';
        const lbl=document.createElement('div'); lbl.className='video-label'; lbl.textContent=name;
        cont.append(vid,lbl); videoGrid.appendChild(cont);
      });
    }

    // ================== INIT ==================
    window.onload = ()=>{ startCamera(); addDummyParticipants(); };
  </script>
</body>
</html>